# 浅谈数据层协议--滑动窗口协议
阅读难度 低
#### 前言
在前面的协议中，数据帧都只是在一个方向上传播，但是，在实际的环境中，往往是需要在两个方向上面传播的。那么我们就来聊一下
双全工传输的协议

在前面的协议，每次传输完一帧，都是要要接收方确认的，但是如果，每一条链路由一条前向信道(用于数据)，和一条逆向信道(用于
确认)组成，我们可以预见，逆向信道的带宽几乎是被完全浪费了。

这个时候我们来想一下，因为数据传输是双向的，机器A向机器B发送数据，然后等待机器B的确认，机器B向机器A发送数据，同样需要
机器A发送确认帧，那么，我们想一下，既然B要向A发送数据，还要对之前A发过来的数据进行确认的话，能不能让确认帧搭一下数据帧
的"顺风车"呢？事实上我们也是这么实现的。这种暂缓确认以便确认信息被附加到向外发送的数据帧上的技术被称为捎带确认。

不过这种技术存在一个问题，暂缓确认来搭数据帧的便车，那要等多久呢，因为你无法预知下一个数据包是什么时候到来，你也没法等待
太长的时间，因为这样，发送方会以为发送失败重新发送的。这个时候就要自定义一个时长了，在这个时长内等待，超过这个时长，
就单独发送一个确认帧，就好像你有事要回家，你想省点车费买零食所以想搭顺风车，但是等了一段时间还没看到车，毕竟是有事要赶回家
，所以只能自己买票回去了
### 滑动窗口协议
在滑动窗口协议中，任何一个出境帧都包含一个序号，范围从0到某个最大值。所有滑动窗口协议的本质都是在任何时刻发送方总是维持
着一组序号，分别对应着允许它发送的帧，我们称这些帧落在发送窗口里面

发送方窗口内的序号代表了那些可以被发送的帧，或者那些已经被发送但还没有被确认的帧。任何时候一个新的数据包从网络层到来
时，它被赋予窗口中的下一个最高序号，并且窗口的上边界向前移动一格.当收到一个确认时，窗口的下边界也前移一个。按照这种方法发送
窗口持续地维持了一系列未被确认的帧,下面决议个大小为1的滑动窗口
![](https://github.com/SeaHub/BlogOfComputerNetwork/blob/master/res/window.png)

由于当前在发送方窗口内的帧可能在传输工程中丢失或者损坏，所以，发送方必须在内存中保存这些帧，以便满足可能的重传的需要
因此，如果最大的窗口尺寸为n，则发送方需要n个缓存区来存放未被确认的帧。如果窗口在某个时刻达到了它的最大尺寸，则发送发的数据链路
层必须强制关闭网络层，直到有一个缓存区空出来。

需要注意一下的是，任何落在窗口外面的帧都会被丢弃，窗口大小为1意味着数据链路层按照正确的顺序接收数据，但是对于大一点的窗口
这个就不成立了。相反，网络层总是按照正确的顺序来接收数据，跟数据链路层的窗口大小没有关系
#### 结语
关于数据链路层我们就先了解到这里了，接下来我会和大家一起学习一下更高层次的协议了

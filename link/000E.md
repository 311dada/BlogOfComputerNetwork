# 应用层之IMAP协议
* 阅读难度：低

## 聊一聊
* 上周我们讨论了POP3协议，这周我们聊一下同样是担任“收邮件”工作的IMAP协议。IMAP协议和POP3孰优孰劣，我们在本文后面会有所讨论...

## IMAP(Interactive/Internet Mail Access Protocol) - (交互式/互联网)邮件访问协议
* 部分属于解释
	* 连接模式：一直监控远程服务器邮件列表状态是否变化（可在邮件客户端设置刷新时间，一般为60s - 180s），若用户通过其他客户端修改邮件列表状态，连接模式下的邮件客户端会将修改数据拉取并合并（这就有点类似于Git的Pull && Merge了）
	* 断开模式：不在监控远程服务器邮件列表的变化 
 
* 一般用户在邮件客户端“收邮件”的流程
	1. 在邮件软件设置IMAP模式、IMAP服务器URL（eg:imap.163.com）以及用户名、密码
	2. 点击收取邮件按钮
	3. 邮件客户端 -> IMAP服务器（进行DNS解析）
	4. 邮件客户端 -> IMAP服务器 143端口(进行TCP连接)
	5. 邮件客户端 <- IMAP服务器（进行认证）
	6. 邮件客户端 -> IMAP服务器(输入用户名、密码)
	7. 邮件客户端 <- IMAP服务器（建立连接模式，传输现在的邮件列表）
	8. 邮件客户端 -> IMAP服务器(用户进行操作，如点进某封邮件，请求服务器数据）
	9. 邮件客户端 <- IMAP服务器(传输用户请求的邮件数据（可能只传部分数据，如附件部分，除非用户点击请求下载，否则不传）)
	10. 邮件客户端 <-> IMAP服务器(在连接模式下，邮件客户端每间隔一段时间自动拉取服务器邮件列表状态并更新)
	11. 邮件客户端 -> IMAP服务器(请求转换至断开模式)
	12. 服务端关闭连接
 	
 	![POP3](https://github.com/SeaHub/BlogOfComputerNetwork/blob/master/res/POP3.png?raw=true)
		
 	
* IMAP的缺陷
	* IMAP需要网络环境用于读取邮件，本身不缓存邮件，离线阅读能力较弱
	
## POP3 VS IMAP

* 比较前言：目前POP3协议以及IMAP协议在很多方面都通过一些扩展的途径来弥补了自身的缺点。比如部分邮件客户端可以在POP3协议工作时不删除服务器邮件，在IMAP协议工作时自动缓存部分邮件。这些扩展很大程度上弥补了POP3与IMAP的缺点，甚至一些能够扩展让他们之间“形同兄弟”。我们下面的优劣比较仅以最原始的POP3协议与IMAP协议进行比较

--- 

1. IMAP对浏览器支持更优，虽然说现在大部分浏览器都支持双协议，但是仍然有部分浏览器仅支持/优先支持IMAP协议
2. IMAP安全性较POP3优。在搭建邮件局域内网时，如果管理员只希望让员工在公司能够访问公司邮件，应该使用IMAP协议。因为IMAP协议需要请求服务器获取数据，当员工在非公司的地方连接网络时，连接的网络非公司内网，不能与公司内网的邮件服务器搭建链接，因此达到了通过内网保护邮件避免外泄的效果
3. 在早期的IMAP、POP3协议中，POP3协议的用户使用邮件客户端时会自动将邮件数据下载到本地（包括各种超大的附件），而IMAP协议支持部分获取（即用户可以先查看邮件再决定是否下载附件，而非先下载整封邮件内容再决定是否打开附件），但这种情况目前POP3已有改进方案
4. IMAP协议允许多个用户同时访问邮箱，而POP3协议假定用户是当前邮箱的唯一用户
5. 使用POP3协议的客户端离线阅读能力较强，IMAP协议较弱。因为IMAP协议每次都要请求服务器获取邮件列表（需要连接网络）。虽然现在大部分邮件客户端在使用IMAP协议时也会自动缓存邮件，但是IMAP离线阅读能力依旧较下载全部邮件副本的POP3协议弱

---

* 我认为，选择POP3还是IMAP需要取决于管理员是想让用户“为了提升离线阅读能力允许离线办公(POP3)”还是,“为了保护数据必须在线办公（IMAP）”。但总体而言，还是IMAP协议更优
	 
---
## 延伸阅读
1. [SMTP协议](https://github.com/SeaHub/BlogOfComputerNetwork/blob/master/link/000A.md)
2. [应用层POP3协议](https://github.com/SeaHub/BlogOfComputerNetwork/blob/master/link/000C.md)

---

* 文章更新时间：2016.5.18
* 作者：Seahub

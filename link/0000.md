# IPv4、IPv6
## IPv4
### 定义
> IPv4(Internet Protocol Version 4, 互联网通讯协议第四版)，是一种使用32位地址的，无连接，工作在网络层(OSI模型第三层)的协议。

### 报头


### IPv4 - 分类网络 - 简述
#### 定义
> 分类网络（Classful Addressing）或称“分级式定址”，是用于描述互联网的网络体系的一个术语。它将IPv4的IP地址分成五个类别。

#### 分类体系
* A类(1 - 126.x.x.x)(形式: "1 + 7 + 24")（单播）
	* 地址介于1 - 126之间
	* 地址组成: 固定一位"0" + 可变7位(网络号) + 可变24位(主机号)
* B类(128 - 191.x.x.x)（形式: "2 + 14 + 16"）(单播)
	* 地址介于128 - 191之间
	* 地址组成: 固定两位"10" + 可变14位(网络号) + 可变16位（主机号）
* C类(193 - 223.x.x.x)(形式: "3 + 21 + 8")(单播)
	* 地址介于192 - 223之间
	* 地址组成: 固定三位"110" + 可变21位(网络号) + 可变8位（主机号）
* D类地址 (224 - 240.x.x.x)（形式:"4 + 28"）(组播)
	* 地址介于224 - 240之间
	* 地址组成:固定四位"1110" + 无特定作用的28位二进制数
* E类地址(240 - 255.x.x.x)(形式:"4 + 28")（保留）
	* 地址介于240 - 255之间
	* 地址组成:固定四位"1111" + 无特定作用的28位二进制数


### IPv4 - 无类域间路由(CIDR) - 简述
#### 定义
> CIDR将路由集中起来，使一个IP地址代表主要骨干服务提供商(ISP)的几千个IP地址，ISP再将地址分配给客户，从而减轻Internet路由器的负担。

#### CIDR主要工作原理
* 子网划分：增加网络位，减少主机位
* 子网汇聚:减少网络位，增加主机位
	* 方法：将VLSM形式表示的IP地址转换成二进制位，抽取相同的二进制位组成超网二进制地址
	* 例子：将192.168.0.0/24，192.168.1.0/23，192.168.2.0/22，192.168.3.0/24汇聚成一个超网地址
					
				step 1: 提取十进制位相同部分,简化计算过程
						由于例子中子网地址均含"192.168",故超网前十六位地址亦为192.168.x.x
				step 2: 将剩余位化为二进制
						192.168.0.0/24 = 192.168.0000 0000.0000 0000
						192.168.1.0/23 = 192.168.0000 0001.0000 0000
						192.168.2.5/22 = 192.168.0000 0010.0000 0101
						192.168.3.0/24 = 192.168.0000 0011.0000 0000
				step 3: 提取相同部分，即为汇聚后的地址：192.168.0.0/22
					
### IPv4 - 特殊的保留地址表
|    IPv4 地址     |     用途     |
| :-------: | :----: |
| 0.0.0.0 | 整个网络中所有主机：帮助路由器发送路由表中无法查询的包 |
| 10.0.0.0 | A类保留地址：用于局域网地址通信 |
| 100.64.0.0 | A类保留地址：用于局域网地址通信 |
| 127.0.0.0 | 环回地址：用于主机向自身发送通讯 |
| 169.254.0.0 | 私有地址：用于自动获取IP地址 |
| 172.16.0.0 | B类保留地址：用于局域网地址通信 |
| 192.0.0.0 | 广播地址：用于广播该网段内的信息 |
| 192.0.2.0 | IANA保留网络测试地址：用于网络测试(TEST-NET-1)  |
| 192.88.99.0 | 6to4中继地址：用于IPv4与IPv6的过渡 |
| 192.168.0.0 | C类保留地址：用于局域网地址通信 |
| 198.18.0.0 | 网络基准测试地址：用于网络性能测试 |
| 198.51.100.0 | IANA保留网络测试地址：用于网络测试(TEST-NET-2)  |
| 203.0.113.0 | IANA保留网络测试地址：用于网络测试(TEST-NET-3)  |
| 224.0.0.0 | 组播基准地址：用于一些特定的程序以及多媒体程序 |
| 240.0.0.0 |  E类保留地址 | 
| 255.255.255.255 | 限制广播地址：用于向本网段内的所有主机发送广播 |
> [完整保留地址表](http://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml)

### IPv4 - 缺陷提出与解决
* 缺陷：
	* 地址缺陷:由于地址空间只有4,294,967,296个(2的32次方)，随着联网设备的不断增加，IPv4地址不够用于分配给每一个用户
	* 性能缺陷：由于部分设计过时，修改后可以提高潜在性能，如减少路由器路由表，解决“路由瓶颈问题”
	* 安全缺陷：IPv4设计只具备最少的安全性选项，应用的安全性责任被扔到了应用层(OSI模型第七层)
* 解决方法：Ipv6的部署


### 子网掩码
#### 定义
> 子网掩码是一种用来指明一个IP地址的哪些位标识的是主机所在的子网，以及哪些位标识的是主机的位掩码
	
#### 作用
1. 将某个IP地址划分成网络地址和主机地址两部分
2. 将一个大的IP网络划分为若干个子网络
3. 判断任意两个IP是否属于同一子网，说明该IP地址是在局域网上还是在远程网上 

#### 相关计算
* 定义：IPv4地址中标识网络号的所有对应二进制位都用"1"，标识主机号的所有对应二进制位都用"0"
* 因此，根据分类网络中A、B、C三类IPv4地址划分，缺省的子网掩码为	
	* A类IPv4地址缺省掩码:255.0.0.0
	* B类IPv4地址缺省掩码:255.255.0.0
	* C类IPv4地址缺省掩码:255.255.255.0
	
* 计算方法
	* 计算子网掩码
		1. 转为二进制
		2. 其中网络位和子网位 = 1，主机位 = 0
		3. 转为点分十进制，得出子网掩码
	* 子网数 = 2的子网位次方 - 2
	* 主机数 = 2的主机位次方 - 2
	* 网络地址 = IP地址 "与" 子网掩码 = 网络位、子网位不变，主机位置零
	* 主机地址 = IP地址 “取反后再与" 子网掩码 
	* 广播地址 = 网络位、子网位不变，主机位置一 = 整个网络段中最后一个IP地址
	
----
## IPv4、IPv6转换方法
1. 隧道：在纯ipv4/ipv6环境下通过映射转换后访问
	* IPv6 over IPv4隧道技术(封包 - 拆包):使得分散的IPv6孤岛可以跨越IPv4网络相互通信
		* GRE隧道技术
		* 手工配置隧道技术
		* 利用IPv4兼容地址的自动隧道技术
		* 6over4技术
		* 6to4技术
		* ISATAP技术
		* Teredo技术
		* 6RD技术
	* IPv4 over IPv6隧道技术:解决具有IPv4的接入设备成为IPv6中的孤岛通信问题
		* DS-Lite隧道技术
2. 双协议栈：使得网络上的节点设备同时支持ipv4与ipv6的协议访问
3. 翻译模式：在IPv4与IPv6之间建立映射关系

>  可通过www.SixXS.org 提供的Ipv通道访问Ipv6 站点的服务访问网站, 后缀 .sixxs.org 代表使用sixxs.org提供的IPv6网关，该网关将来自IPv6网络的http访问请求转换成IPv4的http请求，访问任何其他IPv4的 http都可以使用这个网关，在域名后面加上 ipv4.sixxs.org 即可。

## 补充阅读
1. [OSI模型](https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B)
2. [多播/组播/群播](https://zh.wikipedia.org/wiki/%E5%A4%9A%E6%92%AD)



